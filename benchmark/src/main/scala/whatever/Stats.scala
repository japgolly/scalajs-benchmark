package whatever

object Stats {

  /**
    * Input = DF (degrees of freedom)
    * Confidence level - 0.999 (like JMH)
    *
    * https://www.easycalculation.com/statistics/t-distribution-critical-value-table.php
    * http://www.mysmu.edu/faculty/denisleung/t_table.pdf
    */
  val tDistribution: Int => Double = {
    val values = Array[Double]( // df \ α (2 tail)	0.1	0.05	0.02	0.01	0.005	0.002	0.001
      3.291, // ∞ (σ known) 1.282 1.645 1.960 2.327 2.576 3.091 3.291
      636.0450, // 1	6.3138	12.7065	31.8193	63.6551	127.3447	318.4930	636.0450
      31.5989, // 2	2.9200	4.3026	6.9646	9.9247	14.0887	22.3276	31.5989
      12.9242, // 3	2.3534	3.1824	4.5407	5.8408	7.4534	10.2145	12.9242
      8.6103, // 4	2.1319	2.7764	3.7470	4.6041	5.5976	7.1732	8.6103
      6.8688, // 5	2.0150	2.5706	3.3650	4.0322	4.7734	5.8934	6.8688
      5.9589, // 6	1.9432	2.4469	3.1426	3.7074	4.3168	5.2076	5.9589
      5.4079, // 7	1.8946	2.3646	2.9980	3.4995	4.0294	4.7852	5.4079
      5.0414, // 8	1.8595	2.3060	2.8965	3.3554	3.8325	4.5008	5.0414
      4.7809, // 9	1.8331	2.2621	2.8214	3.2498	3.6896	4.2969	4.7809
      4.5869, // 10	1.8124	2.2282	2.7638	3.1693	3.5814	4.1437	4.5869
      4.4369, // 11	1.7959	2.2010	2.7181	3.1058	3.4966	4.0247	4.4369
      4.3178, // 12	1.7823	2.1788	2.6810	3.0545	3.4284	3.9296	4.3178
      4.2208, // 13	1.7709	2.1604	2.6503	3.0123	3.3725	3.8520	4.2208
      4.1404, // 14	1.7613	2.1448	2.6245	2.9768	3.3257	3.7874	4.1404
      4.0728, // 15	1.7530	2.1314	2.6025	2.9467	3.2860	3.7328	4.0728
      4.0150, // 16	1.7459	2.1199	2.5835	2.9208	3.2520	3.6861	4.0150
      3.9651, // 17	1.7396	2.1098	2.5669	2.8983	3.2224	3.6458	3.9651
      3.9216, // 18	1.7341	2.1009	2.5524	2.8784	3.1966	3.6105	3.9216
      3.8834, // 19	1.7291	2.0930	2.5395	2.8609	3.1737	3.5794	3.8834
      3.8495, // 20	1.7247	2.0860	2.5280	2.8454	3.1534	3.5518	3.8495
      3.8193, // 21	1.7207	2.0796	2.5176	2.8314	3.1352	3.5272	3.8193
      3.7921, // 22	1.7172	2.0739	2.5083	2.8188	3.1188	3.5050	3.7921
      3.7676, // 23	1.7139	2.0686	2.4998	2.8073	3.1040	3.4850	3.7676
      3.7454, // 24	1.7109	2.0639	2.4922	2.7970	3.0905	3.4668	3.7454
      3.7251, // 25	1.7081	2.0596	2.4851	2.7874	3.0782	3.4502	3.7251
      3.7067, // 26	1.7056	2.0555	2.4786	2.7787	3.0669	3.4350	3.7067
      3.6896, // 27	1.7033	2.0518	2.4727	2.7707	3.0565	3.4211	3.6896
      3.6739, // 28	1.7011	2.0484	2.4671	2.7633	3.0469	3.4082	3.6739
      3.6594, // 29	1.6991	2.0452	2.4620	2.7564	3.0380	3.3962	3.6594
      3.6459, // 30	1.6973	2.0423	2.4572	2.7500	3.0298	3.3852	3.6459
      3.6334, // 31	1.6955	2.0395	2.4528	2.7440	3.0221	3.3749	3.6334
      3.6218, // 32	1.6939	2.0369	2.4487	2.7385	3.0150	3.3653	3.6218
      3.6109, // 33	1.6924	2.0345	2.4448	2.7333	3.0082	3.3563	3.6109
      3.6008, // 34	1.6909	2.0322	2.4411	2.7284	3.0019	3.3479	3.6008
      3.5912, // 35	1.6896	2.0301	2.4377	2.7238	2.9961	3.3400	3.5912
      3.5822, // 36	1.6883	2.0281	2.4345	2.7195	2.9905	3.3326	3.5822
      3.5737, // 37	1.6871	2.0262	2.4315	2.7154	2.9853	3.3256	3.5737
      3.5657, // 38	1.6859	2.0244	2.4286	2.7115	2.9803	3.3190	3.5657
      3.5581, // 39	1.6849	2.0227	2.4258	2.7079	2.9756	3.3128	3.5581
      3.5510, // 40	1.6839	2.0211	2.4233	2.7045	2.9712	3.3069	3.5510
      3.5442, // 41	1.6829	2.0196	2.4208	2.7012	2.9670	3.3013	3.5442
      3.5378, // 42	1.6820	2.0181	2.4185	2.6981	2.9630	3.2959	3.5378
      3.5316, // 43	1.6811	2.0167	2.4162	2.6951	2.9591	3.2909	3.5316
      3.5258, // 44	1.6802	2.0154	2.4142	2.6923	2.9555	3.2861	3.5258
      3.5202, // 45	1.6794	2.0141	2.4121	2.6896	2.9521	3.2815	3.5202
      3.5149, // 46	1.6787	2.0129	2.4102	2.6870	2.9488	3.2771	3.5149
      3.5099, // 47	1.6779	2.0117	2.4083	2.6846	2.9456	3.2729	3.5099
      3.5051, // 48	1.6772	2.0106	2.4066	2.6822	2.9426	3.2689	3.5051
      3.5004, // 49	1.6766	2.0096	2.4049	2.6800	2.9397	3.2651	3.5004
      3.4960, // 50	1.6759	2.0086	2.4033	2.6778	2.9370	3.2614	3.4960
      3.4917, // 51	1.6753	2.0076	2.4017	2.6757	2.9343	3.2579	3.4917
      3.4877, // 52	1.6747	2.0066	2.4002	2.6737	2.9318	3.2545	3.4877
      3.4838, // 53	1.6741	2.0057	2.3988	2.6718	2.9293	3.2513	3.4838
      3.4800, // 54	1.6736	2.0049	2.3974	2.6700	2.9270	3.2482	3.4800
      3.4764, // 55	1.6730	2.0041	2.3961	2.6682	2.9247	3.2451	3.4764
      3.4730, // 56	1.6725	2.0032	2.3948	2.6665	2.9225	3.2423	3.4730
      3.4696, // 57	1.6720	2.0025	2.3936	2.6649	2.9204	3.2394	3.4696
      3.4663, // 58	1.6715	2.0017	2.3924	2.6633	2.9184	3.2368	3.4663
      3.4632, // 59	1.6711	2.0010	2.3912	2.6618	2.9164	3.2342	3.4632
      3.4602, // 60	1.6706	2.0003	2.3901	2.6603	2.9146	3.2317	3.4602
      3.4573, // 61	1.6702	1.9996	2.3890	2.6589	2.9127	3.2293	3.4573
      3.4545, // 62	1.6698	1.9990	2.3880	2.6575	2.9110	3.2269	3.4545
      3.4518, // 63	1.6694	1.9983	2.3870	2.6561	2.9092	3.2247	3.4518
      3.4491, // 64	1.6690	1.9977	2.3860	2.6549	2.9076	3.2225	3.4491
      3.4466, // 65	1.6686	1.9971	2.3851	2.6536	2.9060	3.2204	3.4466
      3.4441, // 66	1.6683	1.9966	2.3842	2.6524	2.9045	3.2184	3.4441
      3.4417, // 67	1.6679	1.9960	2.3833	2.6512	2.9030	3.2164	3.4417
      3.4395, // 68	1.6676	1.9955	2.3824	2.6501	2.9015	3.2144	3.4395
      3.4372, // 69	1.6673	1.9950	2.3816	2.6490	2.9001	3.2126	3.4372
      3.4350, // 70	1.6669	1.9944	2.3808	2.6479	2.8987	3.2108	3.4350
      3.4329, // 71	1.6666	1.9939	2.3800	2.6468	2.8974	3.2090	3.4329
      3.4308, // 72	1.6663	1.9935	2.3793	2.6459	2.8961	3.2073	3.4308
      3.4288, // 73	1.6660	1.9930	2.3785	2.6449	2.8948	3.2056	3.4288
      3.4269, // 74	1.6657	1.9925	2.3778	2.6439	2.8936	3.2040	3.4269
      3.4250, // 75	1.6654	1.9921	2.3771	2.6430	2.8925	3.2025	3.4250
      3.4232, // 76	1.6652	1.9917	2.3764	2.6421	2.8913	3.2010	3.4232
      3.4214, // 77	1.6649	1.9913	2.3758	2.6412	2.8902	3.1995	3.4214
      3.4197, // 78	1.6646	1.9909	2.3751	2.6404	2.8891	3.1980	3.4197
      3.4180, // 79	1.6644	1.9904	2.3745	2.6395	2.8880	3.1966	3.4180
      3.4164, // 80	1.6641	1.9901	2.3739	2.6387	2.8870	3.1953	3.4164
      3.4147, // 81	1.6639	1.9897	2.3733	2.6379	2.8859	3.1939	3.4147
      3.4132, // 82	1.6636	1.9893	2.3727	2.6371	2.8850	3.1926	3.4132
      3.4117, // 83	1.6634	1.9889	2.3721	2.6364	2.8840	3.1913	3.4117
      3.4101, // 84	1.6632	1.9886	2.3716	2.6356	2.8831	3.1901	3.4101
      3.4087, // 85	1.6630	1.9883	2.3710	2.6349	2.8821	3.1889	3.4087
      3.4073, // 86	1.6628	1.9879	2.3705	2.6342	2.8813	3.1877	3.4073
      3.4059, // 87	1.6626	1.9876	2.3700	2.6335	2.8804	3.1866	3.4059
      3.4046, // 88	1.6623	1.9873	2.3695	2.6328	2.8795	3.1854	3.4046
      3.4032, // 89	1.6622	1.9870	2.3690	2.6322	2.8787	3.1844	3.4032
      3.4020, // 90	1.6620	1.9867	2.3685	2.6316	2.8779	3.1833	3.4020
      3.4006, // 91	1.6618	1.9864	2.3680	2.6309	2.8771	3.1822	3.4006
      3.3995, // 92	1.6616	1.9861	2.3676	2.6303	2.8763	3.1812	3.3995
      3.3982, // 93	1.6614	1.9858	2.3671	2.6297	2.8755	3.1802	3.3982
      3.3970, // 94	1.6612	1.9855	2.3667	2.6292	2.8748	3.1792	3.3970
      3.3959, // 95	1.6610	1.9852	2.3662	2.6286	2.8741	3.1782	3.3959
      3.3947, // 96	1.6609	1.9850	2.3658	2.6280	2.8734	3.1773	3.3947
      3.3936, // 97	1.6607	1.9847	2.3654	2.6275	2.8727	3.1764	3.3936
      3.3926, // 98	1.6606	1.9845	2.3650	2.6269	2.8720	3.1755	3.3926
      3.3915, // 99	1.6604	1.9842	2.3646	2.6264	2.8713	3.1746	3.3915
      3.3905, // 100	1.6602	1.9840	2.3642	2.6259	2.8706	3.1738	3.3905
      3.3894, // 101	1.6601	1.9837	2.3638	2.6254	2.8700	3.1729	3.3894
      3.3885, // 102	1.6599	1.9835	2.3635	2.6249	2.8694	3.1720	3.3885
      3.3875, // 103	1.6598	1.9833	2.3631	2.6244	2.8687	3.1712	3.3875
      3.3866, // 104	1.6596	1.9830	2.3627	2.6240	2.8682	3.1704	3.3866
      3.3856, // 105	1.6595	1.9828	2.3624	2.6235	2.8675	3.1697	3.3856
      3.3847, // 106	1.6593	1.9826	2.3620	2.6230	2.8670	3.1689	3.3847
      3.3838, // 107	1.6592	1.9824	2.3617	2.6225	2.8664	3.1681	3.3838
      3.3829, // 108	1.6591	1.9822	2.3614	2.6221	2.8658	3.1674	3.3829
      3.3820, // 109	1.6589	1.9820	2.3611	2.6217	2.8653	3.1667	3.3820
      3.3812, // 110	1.6588	1.9818	2.3607	2.6212	2.8647	3.1660	3.3812
      3.3803, // 111	1.6587	1.9816	2.3604	2.6208	2.8642	3.1653	3.3803
      3.3795, // 112	1.6586	1.9814	2.3601	2.6204	2.8637	3.1646	3.3795
      3.3787, // 113	1.6585	1.9812	2.3598	2.6200	2.8632	3.1640	3.3787
      3.3779, // 114	1.6583	1.9810	2.3595	2.6196	2.8627	3.1633	3.3779
      3.3771, // 115	1.6582	1.9808	2.3592	2.6192	2.8622	3.1626	3.3771
      3.3764, // 116	1.6581	1.9806	2.3589	2.6189	2.8617	3.1620	3.3764
      3.3756, // 117	1.6580	1.9805	2.3586	2.6185	2.8612	3.1614	3.3756
      3.3749, // 118	1.6579	1.9803	2.3583	2.6181	2.8608	3.1607	3.3749
      3.3741, // 119	1.6578	1.9801	2.3581	2.6178	2.8603	3.1601	3.3741
      3.3735, // 120	1.6577	1.9799	2.3578	2.6174	2.8599	3.1595	3.3735
      3.3727, // 121	1.6575	1.9798	2.3576	2.6171	2.8594	3.1589	3.3727
      3.3721, // 122	1.6574	1.9796	2.3573	2.6168	2.8590	3.1584	3.3721
      3.3714, // 123	1.6573	1.9794	2.3571	2.6164	2.8585	3.1578	3.3714
      3.3707, // 124	1.6572	1.9793	2.3568	2.6161	2.8582	3.1573	3.3707
      3.3700, // 125	1.6571	1.9791	2.3565	2.6158	2.8577	3.1567	3.3700
      3.3694, // 126	1.6570	1.9790	2.3563	2.6154	2.8573	3.1562	3.3694
      3.3688, // 127	1.6570	1.9788	2.3561	2.6151	2.8569	3.1556	3.3688
      3.3682, // 128	1.6568	1.9787	2.3559	2.6148	2.8565	3.1551	3.3682
      3.3676, // 129	1.6568	1.9785	2.3556	2.6145	2.8561	3.1546	3.3676
      3.3669, // 130	1.6567	1.9784	2.3554	2.6142	2.8557	3.1541	3.3669
      3.3663, // 131	1.6566	1.9782	2.3552	2.6139	2.8554	3.1536	3.3663
      3.3658, // 132	1.6565	1.9781	2.3549	2.6136	2.8550	3.1531	3.3658
      3.3652, // 133	1.6564	1.9779	2.3547	2.6133	2.8546	3.1526	3.3652
      3.3646, // 134	1.6563	1.9778	2.3545	2.6130	2.8542	3.1522	3.3646
      3.3641, // 135	1.6562	1.9777	2.3543	2.6127	2.8539	3.1517	3.3641
      3.3635, // 136	1.6561	1.9776	2.3541	2.6125	2.8536	3.1512	3.3635
      3.3630, // 137	1.6561	1.9774	2.3539	2.6122	2.8532	3.1508	3.3630
      3.3624, // 138	1.6560	1.9773	2.3537	2.6119	2.8529	3.1503	3.3624
      3.3619, // 139	1.6559	1.9772	2.3535	2.6117	2.8525	3.1499	3.3619
      3.3614, // 140	1.6558	1.9771	2.3533	2.6114	2.8522	3.1495	3.3614
      3.3609, // 141	1.6557	1.9769	2.3531	2.6112	2.8519	3.1491	3.3609
      3.3604, // 142	1.6557	1.9768	2.3529	2.6109	2.8516	3.1486	3.3604
      3.3599, // 143	1.6556	1.9767	2.3527	2.6106	2.8512	3.1482	3.3599
      3.3594, // 144	1.6555	1.9766	2.3525	2.6104	2.8510	3.1478	3.3594
      3.3589, // 145	1.6554	1.9765	2.3523	2.6102	2.8506	3.1474	3.3589
      3.3584, // 146	1.6554	1.9764	2.3522	2.6099	2.8503	3.1470	3.3584
      3.3579, // 147	1.6553	1.9762	2.3520	2.6097	2.8500	3.1466	3.3579
      3.3575, // 148	1.6552	1.9761	2.3518	2.6094	2.8497	3.1462	3.3575
      3.3570, // 149	1.6551	1.9760	2.3516	2.6092	2.8494	3.1458	3.3570
      3.3565, // 150	1.6551	1.9759	2.3515	2.6090	2.8491	3.1455	3.3565
      3.3561, // 151	1.6550	1.9758	2.3513	2.6088	2.8489	3.1451	3.3561
      3.3557, // 152	1.6549	1.9757	2.3511	2.6085	2.8486	3.1447	3.3557
      3.3552, // 153	1.6549	1.9756	2.3510	2.6083	2.8483	3.1443	3.3552
      3.3548, // 154	1.6548	1.9755	2.3508	2.6081	2.8481	3.1440	3.3548
      3.3544, // 155	1.6547	1.9754	2.3507	2.6079	2.8478	3.1436	3.3544
      3.3540, // 156	1.6547	1.9753	2.3505	2.6077	2.8475	3.1433	3.3540
      3.3536, // 157	1.6546	1.9752	2.3503	2.6075	2.8472	3.1430	3.3536
      3.3531, // 158	1.6546	1.9751	2.3502	2.6073	2.8470	3.1426	3.3531
      3.3528, // 159	1.6545	1.9750	2.3500	2.6071	2.8467	3.1423	3.3528
      3.3523, // 160	1.6544	1.9749	2.3499	2.6069	2.8465	3.1419	3.3523
      3.3520, // 161	1.6544	1.9748	2.3497	2.6067	2.8463	3.1417	3.3520
      3.3516, // 162	1.6543	1.9747	2.3496	2.6065	2.8460	3.1413	3.3516
      3.3512, // 163	1.6543	1.9746	2.3495	2.6063	2.8458	3.1410	3.3512
      3.3508, // 164	1.6542	1.9745	2.3493	2.6062	2.8455	3.1407	3.3508
      3.3505, // 165	1.6542	1.9744	2.3492	2.6060	2.8452	3.1403	3.3505
      3.3501, // 166	1.6541	1.9744	2.3490	2.6058	2.8450	3.1400	3.3501
      3.3497, // 167	1.6540	1.9743	2.3489	2.6056	2.8448	3.1398	3.3497
      3.3494, // 168	1.6540	1.9742	2.3487	2.6054	2.8446	3.1394	3.3494
      3.3490, // 169	1.6539	1.9741	2.3486	2.6052	2.8443	3.1392	3.3490
      3.3487, // 170	1.6539	1.9740	2.3485	2.6051	2.8441	3.1388	3.3487
      3.3483, // 171	1.6538	1.9739	2.3484	2.6049	2.8439	3.1386	3.3483
      3.3480, // 172	1.6537	1.9739	2.3482	2.6047	2.8437	3.1383	3.3480
      3.3477, // 173	1.6537	1.9738	2.3481	2.6046	2.8435	3.1380	3.3477
      3.3473, // 174	1.6537	1.9737	2.3480	2.6044	2.8433	3.1377	3.3473
      3.3470, // 175	1.6536	1.9736	2.3478	2.6042	2.8430	3.1375	3.3470
      3.3466, // 176	1.6536	1.9735	2.3477	2.6041	2.8429	3.1372	3.3466
      3.3464, // 177	1.6535	1.9735	2.3476	2.6039	2.8427	3.1369	3.3464
      3.3460, // 178	1.6535	1.9734	2.3475	2.6037	2.8424	3.1366	3.3460
      3.3457, // 179	1.6534	1.9733	2.3474	2.6036	2.8423	3.1364	3.3457
      3.3454, // 180	1.6534	1.9732	2.3472	2.6034	2.8420	3.1361	3.3454
      3.3451, // 181	1.6533	1.9731	2.3471	2.6033	2.8419	3.1358	3.3451
      3.3448, // 182	1.6533	1.9731	2.3470	2.6031	2.8416	3.1356	3.3448
      3.3445, // 183	1.6532	1.9730	2.3469	2.6030	2.8415	3.1354	3.3445
      3.3442, // 184	1.6532	1.9729	2.3468	2.6028	2.8413	3.1351	3.3442
      3.3439, // 185	1.6531	1.9729	2.3467	2.6027	2.8411	3.1349	3.3439
      3.3436, // 186	1.6531	1.9728	2.3466	2.6025	2.8409	3.1346	3.3436
      3.3433, // 187	1.6531	1.9727	2.3465	2.6024	2.8407	3.1344	3.3433
      3.3430, // 188	1.6530	1.9727	2.3463	2.6022	2.8406	3.1341	3.3430
      3.3428, // 189	1.6529	1.9726	2.3463	2.6021	2.8403	3.1339	3.3428
      3.3425, // 190	1.6529	1.9725	2.3461	2.6019	2.8402	3.1337	3.3425
      3.3422, // 191	1.6529	1.9725	2.3460	2.6018	2.8400	3.1334	3.3422
      3.3419, // 192	1.6528	1.9724	2.3459	2.6017	2.8398	3.1332	3.3419
      3.3417, // 193	1.6528	1.9723	2.3458	2.6015	2.8397	3.1330	3.3417
      3.3414, // 194	1.6528	1.9723	2.3457	2.6014	2.8395	3.1328	3.3414
      3.3411, // 195	1.6527	1.9722	2.3456	2.6013	2.8393	3.1326	3.3411
      3.3409, // 196	1.6527	1.9721	2.3455	2.6012	2.8392	3.1323	3.3409
      3.3406, // 197	1.6526	1.9721	2.3454	2.6010	2.8390	3.1321	3.3406
      3.3403, // 198	1.6526	1.9720	2.3453	2.6009	2.8388	3.1319	3.3403
      3.3401, // 199	1.6525	1.9720	2.3452	2.6008	2.8387	3.1317	3.3401
      3.3398) // 200	1.6525	1.9719	2.3451	2.6007	2.8385	3.1315	3.3398

    df =>
      if (df >= 0 && df < values.length)
        values(df)
      else
        values(0)
  }
}

case class Stats(sample: Traversable[Double]) {
  import Math._

  val size = sample.size

  /** Mean / Average. */
  val mean = sample.sum / size

  /** Sample variance */
  val variance = sample.toIterator.map(s => pow(s - mean, 2)).sum / (size - 1)

  /** Standard deviation */
  val stddev = sqrt(variance)

  /** Standard error of the mean. */
  val sem = stddev / sqrt(size)

  val marginOfError = stddev * 2


  // degrees of freedom
//  private def df = size - 1

//  private def critical = Stats.tDistribution(df)

//  val marginOfError = sem * critical

  // relative margin of error.
  val rme = (marginOfError / mean) * 100.0

//  org.scalajs.dom.console.log(s"mean: $mean, var: $variance, sd: $stddev, moe: $marginOfError, rme: $rme\n", scalajs.js.Array[Double](sample.toSeq.sorted.reverse: _*))
//  println(s"mean: $mean, var: $variance, sd: $stddev, moe: $marginOfError, rme: $rme")
}